services:
  control-plane:
    image: playground/control-plane:latest
    environment:
      PLAYGROUND_STORAGE_MODE: local
      PLAYGROUND_HTTP_ADDR: 0.0.0.0:8080
      OPENROUTER_API_KEY: ${OPENROUTER_API_KEY}
    ports:
      - "8080:8080"
    volumes:
      - playground-data:/data

  rag-agent:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        # Set to false for faster builds without ML dependencies
        INSTALL_ML_DEPS: ${INSTALL_ML_DEPS:-true}
    environment:
      PLAYGROUND_URL: http://control-plane:8080
      HANZO_CALLBACK_URL: http://rag-agent:8001
      OPENROUTER_API_KEY: ${OPENROUTER_API_KEY}
      PORT: 8001
    ports:
      - "8001:8001"
    depends_on:
      - control-plane
    restart: on-failure

  ui:
    build:
      context: ./ui
      dockerfile: Dockerfile
    environment:
      NEXT_PUBLIC_API_URL: http://localhost:8080
    ports:
      - "3000:3000"
    depends_on:
      - rag-agent

volumes:
  playground-data:
